â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ARTHA TRADING TERMINAL - PROFESSIONAL ENHANCEMENT INSTRUCTIONS   â•‘
â•‘  Target: Transform into Bloomberg Terminal-style professional UI  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– FULL DETAILS: Read docs/QWEN_ENHANCEMENT_PROMPT.md
ğŸ§ª TESTING: Follow 18 test cases in the document
ğŸ” HELP: Use context7 for Textual patterns, tavily for domain knowledge

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš¨ PHASE 1: CRITICAL FIXES (DO THIS FIRST!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Fix #1: src/tui/screens/trade_modal.py
âŒ Problem: Cannot exit modal with Escape key
âœ… Solution: Add on_key() event handler that captures Escape before widgets

Fix #2: src/database/dao.py (save_positions function)
âŒ Problem: UNIQUE constraint violation crashes game on day advance
âœ… Solution: Use UPDATE/INSERT/DELETE pattern instead of DELETE-all + INSERT-all

ğŸ“ Detailed fixes in docs/QWEN_CRITICAL_FIXES_NOW.md
ğŸ§ª Test: Press Escape in modal, advance 10 days - should work smoothly

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¨ PHASE 2: PROFESSIONAL TRADING TERMINAL UI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Transform main_screen.py into multi-panel trading dashboard:

âœ… Top metrics bar (Day, Cash, Portfolio, P&L, P&L%)
âœ… Live scrolling ticker with all positions
âœ… Multi-panel layout (left: charts + portfolio, right: watchlist + coach)
âœ… Enhanced DataTable with color-coded P&L and XIRR column
âœ… Professional color scheme (green=positive, red=negative)
âœ… Tab panels for Positions / History views

Reference UIs:
- Bloomberg Terminal layout
- Zerodha Kite trading platform
- TradingView charts
- dolphie TUI: https://github.com/charles-001/dolphie
- memray TUI: https://github.com/bloomberg/memray

If stuck: context7 "Textual DataTable color coding and layout patterns"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š PHASE 3: LIVE CHARTS AND VISUALIZATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create/enhance widgets:

1. PortfolioChartWidget (src/tui/widgets/chart_widget.py)
   - Multiple series: Total Value, Stocks Value, Cash
   - Horizontal line for initial capital (benchmark)
   - Uses plotext with dark theme
   - Reactive updates on day advance

2. LiveTickerWidget (src/tui/widgets/live_ticker.py)
   - Scrolling ticker tape at top
   - Shows Symbol: Price (+/-X.XX%)
   - Auto-refreshes every 2 seconds

3. StockMiniChart (src/tui/widgets/chart_widget.py)
   - Compact sparklines for watchlist
   - 30-day price history
   - Shows symbol and % change

4. WatchlistWidget (src/tui/widgets/watchlist.py)
   - Default stocks: RELIANCE, TCS, INFY, HDFCBANK, ICICIBANK
   - Each stock has mini chart
   - Shows current price and trend

If stuck: context7 "plotext multi-series line charts terminal"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ® PHASE 4: REALISTIC MARKET SIMULATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Enhance src/data/loader.py with realistic market dynamics:

âœ… Market sentiment: -1 (bearish) to +1 (bullish), random walk
âœ… Volatility regimes: low/normal/high with Markov switching
âœ… Stock betas: Different stocks react differently to market
   - RELIANCE: 1.2 (aggressive)
   - TCS: 0.8 (defensive)
   - HDFCBANK: 1.0 (market)
âœ… Correlated returns: All stocks move somewhat together
âœ… Daily returns: ~1-3% typical, not wild 50% swings
âœ… Add get_price_history() method for chart data

If stuck: tavily "stock market simulation random walk realistic returns"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª TESTING CRITERIA (RUN AFTER EACH PHASE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Critical Tests (Must Pass):
âœ… Test 1: Escape key closes modal from any input field
âœ… Test 2: Advance 10 days without database errors
âœ… Test 3: Buy same stock twice, advance days - correct quantities
âœ… Test 4: Portfolio chart visible with line graph
âœ… Test 5: Chart updates when pressing spacebar
âœ… Test 6: XIRR column shows in portfolio grid
âœ… Test 9: Game continues past day 280 to day 500+

Edge Cases:
âœ… Test 14: Sell all shares - position disappears
âœ… Test 15: Insufficient funds - clear error message
âœ… Test 16: Empty portfolio - shows "No positions" gracefully
âœ… Test 18: Negative P&L shows in red text

Full test suite (18 tests) in docs/QWEN_ENHANCEMENT_PROMPT.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” USING CONTEXT7 AND TAVILY SEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Use context7 when:
âœ… Finding Textual framework patterns
âœ… Looking for plotext examples
âœ… Searching reactive widget patterns
âœ… Finding DataTable usage examples

Example: context7 "Textual ModalScreen Escape key handling"

Use tavily search when:
âœ… Researching trading terminal UI designs
âœ… Learning financial calculations (XIRR, beta, returns)
âœ… Understanding market simulation theory
âœ… Finding domain knowledge about stock markets

Example: tavily "Bloomberg terminal layout design principles"

Decision tree:
- Textual framework issue? â†’ context7
- Financial domain knowledge? â†’ tavily
- UI design inspiration? â†’ tavily
- Code patterns? â†’ context7

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ IMPLEMENTATION CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 1 - Critical Fixes:
[ ] Fix trade_modal.py escape key
[ ] Fix dao.py database constraint
[ ] Test modal closes with Escape
[ ] Test day advancement works

Phase 2 - Professional UI:
[ ] Update main_screen.py layout
[ ] Add metric cards
[ ] Create live ticker widget
[ ] Enhance portfolio DataTable
[ ] Add XIRR column

Phase 3 - Live Charts:
[ ] Enhance PortfolioChartWidget
[ ] Create StockMiniChart
[ ] Create LiveTickerWidget
[ ] Create WatchlistWidget

Phase 4 - Market Simulation:
[ ] Add market sentiment
[ ] Add volatility regimes
[ ] Implement stock betas
[ ] Add correlated returns
[ ] Test realistic price changes

Phase 5 - Testing:
[ ] Run all 18 test cases
[ ] Fix any failures
[ ] Document issues

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ SUCCESS METRICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… All 18 tests pass without crashes
âœ… Game responds within 100ms to actions
âœ… Charts update smoothly with correct data
âœ… Prices change 1-3% per day on average
âœ… UI looks professional (not hacky)
âœ… Game runs 500+ days without memory leaks
âœ… Coach provides personalized insights
âœ… Data survives save/load cycles

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ START HERE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Read docs/QWEN_ENHANCEMENT_PROMPT.md for full details
2. Start with Phase 1 critical fixes (MANDATORY)
3. Test after each phase
4. Use context7/tavily when stuck
5. Follow the 18-test suite
6. Check off items in checklist as you complete them

Goal: Professional Bloomberg Terminal-style trading simulator with
      realistic market dynamics and intelligent AI coaching.

Good luck! ğŸ®ğŸ“ˆ
